<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Stryke Force">
  <title>Swerve Drive</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../static/reveal.js/dist/reset.css">
  <link rel="stylesheet" href="../static/reveal.js/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../static/reveal.js/dist/theme/white.css" id="theme">
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Swerve Drive</h1>
  <p class="author">Stryke Force</p>
</section>

<section>
<section id="swerve-drive-introduction" class="title-slide slide level1">
<h1>Swerve Drive Introduction</h1>

</section>
<section id="mechanical-design" class="slide level2">
<h2>Mechanical Design</h2>
<ul>
<li>Motors &amp; Controllers</li>
<li>Drive</li>
<li>Azimuth - turns</li>
</ul>
<p>Put a picture here.</p>
</section>
<section id="swerve-operation" class="slide level2">
<h2>Swerve Operation</h2>
<ul>
<li>Forward / Back</li>
<li>Strafe Left / Right</li>
</ul>
</section>
<section id="swerve-control-systems" class="slide level2">
<h2>Swerve Control Systems</h2>
<ul>
<li>Azimuth closed-loop</li>
<li>Drive open-loop</li>
<li>Drive closed-loop</li>
</ul>
</section></section>
<section>
<section id="swerve-drive-motion" class="title-slide slide level1" data-background-color="rgb(241, 186, 27)">
<h1 data-background-color="rgb(241, 186, 27)">Swerve Drive Motion</h1>
<p>To move the swerve drive, we need to convert the desired motion of the robot<br />
into positions and speeds of each of the four swerve wheels.</p>
</section>
<section id="swerve-motion" class="slide level2">
<h2>Swerve Motion</h2>
<p>There are three components to swerve drive motion.</p>
<ul>
<li><strong>Forward</strong> and backwards</li>
<li><strong>Strafe</strong> left and right</li>
<li><strong>Yaw</strong> counter-clockwise and clockwise</li>
</ul>
<p><img data-src="img/swerve-math/directions.svg" alt="swerve directions" /><br />
</p>
<p>The red arrows indicate the <strong>speed</strong> and <strong>direction</strong> each wheel is pushing.</p>
<p>We call this the <strong>velocity vector</strong> of the wheel.</p>
</section>
<section id="swerve-motion-1" class="slide level2">
<h2>Swerve Motion</h2>
<p>These separate components can be combined together to move the robot in any direction.</p>
<p><img data-src="img/swerve-math/forward+strafe.svg" alt="forward+strafe" /><br />
</p>
<p>In this example, equal amounts of <strong>forward</strong> and <strong>strafe</strong> input drive the robot at 45° across the field.</p>
</section>
<section id="swerve-motion-2" class="slide level2">
<h2>Swerve Motion</h2>
<p>All three components can be combined together to produce complex motion.</p>
<p><img data-src="img/swerve-math/forward+strafe+yaw.svg" alt="forward+strafe" /><br />
</p>
<p>In this example, equal amounts of <strong>forward</strong>, <strong>strafe</strong> and <strong>yaw</strong> input drive the robot across the field while yawing.</p>
</section>
<section id="swerve-yaw-component" class="slide level2">
<h2>Swerve Yaw Component</h2>
<p>When the robot yaws, the wheels are positioned perpendicular to the center of rotation.</p>
<p>Note that this is not 45° if the robot isn’t square.</p>
<p><img data-src="img/swerve-math/frame-aspect.svg" alt="frame aspect ration" /><br />
</p>
<p>We can also yaw around an arbitrary off-center point relative to the robot.</p>
</section></section>
<section>
<section id="swerve-math" class="title-slide slide level1" data-background-color="rgb(241, 186, 27)">
<h1 data-background-color="rgb(241, 186, 27)">Swerve Math</h1>
<p>We can calculate desired position and speed of each wheel using vectors.</p>
</section>
<section id="vectors" class="slide level2">
<h2>Vectors</h2>
<p>We use <strong>vectors</strong> to represent velocity, which is speed and direction.</p>
<p><img data-src="img/swerve-math/vectors.svg" alt="vectors" /><br />
</p>
<p>Here we show how to add two vectors together, later we will show rotating a vector by a given angle.</p>
</section>
<section id="coordinate-frames" class="slide level2">
<h2>Coordinate Frames</h2>
<p>We work in two coordinate frames, one local to the robot and one global for the field.</p>
<p>Going forward, we’ll also refer to swerve drive motion components (forward, strafe, yaw) as chassis speed (<strong>v<sub>x</sub></strong>, <strong>v<sub>y</sub></strong>, and <strong>ω</strong>), with respect to the robot frame of reference.</p>
<p><img data-src="img/swerve-math/coordinate-frames.svg" alt="coordinate frames" /><br />
</p>
</section>
<section id="wheel-position-and-speed" class="slide level2">
<h2>Wheel Position and Speed</h2>
<p>We add together the desired robot-oriented velocity inputs to get a velocity vector for each wheel.</p>
<p><img data-src="img/swerve-math/wheel-vectors.svg" alt="coordinate frames" /><br />
</p>
</section>
<section id="wheel-speed-and-azimuth" class="slide level2">
<h2>Wheel Speed and Azimuth</h2>
<p>Each wheel’s <strong>speed</strong> and <strong>azimuth</strong> can be calculated from its velocity vector (<strong>v</strong><sub>w</sub>).</p>
<p><img data-src="img/swerve-math/wheel-position+speed.svg" alt="wheel position + speed" /><br />
</p>
<p><strong>Azimuth</strong> (θ) is the term we use for the wheel’s angle relative to the robot frame of reference.</p>
</section>
<section id="normalize-wheel-speeds" class="slide level2">
<h2>Normalize Wheel Speeds</h2>
<p>Sometimes after calculating wheel velocity vectors, the requested speed may be above the maximum attainable speed for the drive motor on that swerve module.</p>
<p>To fix this issue, we “normalize” all the wheel speeds to make sure that all requested module speeds are below the absolute threshold, while maintaining the ratio of speeds between modules.</p>
<p><br />
</p>
<table>
<thead>
<tr class="header">
<th>Wheel</th>
<th style="text-align: right;">Calculated Speed</th>
<th style="text-align: right;">Normalized Speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LF</td>
<td style="text-align: right;">2.414</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td>RF</td>
<td style="text-align: right;">1.732</td>
<td style="text-align: right;">0.717</td>
</tr>
<tr class="odd">
<td>LR</td>
<td style="text-align: right;">1.732</td>
<td style="text-align: right;">0.717</td>
</tr>
<tr class="even">
<td>RR</td>
<td style="text-align: right;">0.414</td>
<td style="text-align: right;">0.172</td>
</tr>
</tbody>
</table>
</section>
<section id="optimize-wheel-position" class="slide level2">
<h2>Optimize Wheel Position</h2>
<p>We minimize the change in heading the desired swerve wheel direction would require<br />
by potentially reversing the direction the wheel spins.</p>
<p>When optimized, the furthest a wheel will ever rotate is 90 degrees.</p>
<div class="columns">
<div class="column" style="display:inline-flex; flex-direction: column; justify-content: center; height: 766px">
<p>If the difference between your desired and current azimuth is greater than 90°, rotate the desired azimuth by 180° and reverse the drive motor.</p>
</div><div class="column" style="width:50%;">
<p><img data-src="img/swerve-math/optimized-azimuth.svg" alt="optimize azimuth" /><br />
</p>
</div>
</div>
</section>
<section id="field-oriented-driving" class="slide level2">
<h2>Field Oriented Driving</h2>
<p>In Teleoperation, we normally provide driver joystick (velocity) inputs<br />
relative to the field frame of reference.</p>
<p>We rotate the requested field-oriented robot velocity vector by an amount equal<br />
to the gyro angle, θ, to get the desired robot-oriented velocity vector.</p>
<p><img data-src="img/swerve-math/field-oriented.svg" alt="optimize azimuth" /><br />
</p>
<p>In this example, pushing the <strong>v</strong><sub>x</sub> (F/R) joystick in the postive x direction<br />
will move the robot directly down the field, no matter the direction the robot is facing (θ).</p>
</section></section>
<section>
<section id="swerve-software" class="title-slide slide level1" data-background-color="rgb(241, 186, 27)">
<h1 data-background-color="rgb(241, 186, 27)">Swerve Software</h1>
<p>In our robot, we use the WPILIB kinematics suite to convert<br />
desired velocities to swerve module speed and angle.</p>
</section>
<section id="terminology" class="slide level2">
<h2>Terminology</h2>
<dl>
<dt>Kinematics</dt>
<dd><p>The kinematics classes help convert between a universal <code>ChassisSpeeds</code> object, containing linear and angular velocities for a robot to usable speeds for each individual module states (speed and angle) for a swerve drive.</p>
</dd>
<dt>Odometry</dt>
<dd><p>Odometry uses sensors on the robot to create an estimate of the position of the robot on the field. In our robots, these sensors are typically drive and azimuth encoders and a gyroscope to measure robot angle.</p>
</dd>
<dd><p>The odometry classes utilize the kinematics classes along with periodic inputs about speeds and angles to create an estimate of the robot’s location on the field.</p>
</dd>
</dl>
</section>
<section id="the-chassisspeeds-class" class="slide level2">
<h2>the <code>ChassisSpeeds</code> Class</h2>
<p>The <code>ChassisSpeeds</code> object represents the speeds of a robot chassis.</p>
<p>Speeds are given in meters per second.</p>
<dl>
<dt><code>vx</code></dt>
<dd>The velocity of the robot in the <strong>x</strong> (forward) direction.
</dd>
<dt><code>vy</code></dt>
<dd>The velocity of the robot in the <strong>y</strong> (strafe) direction.<br />
Positive values mean the robot is moving to the left.
</dd>
<dt><code>omega</code></dt>
<dd>The angular velocity of the robot in radians per second.<br />
Positive is CCW rotation (yaw) of the robot.
</dd>
</dl>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>var xSpeed <span class="op">=</span> leftJoystick<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> kMaxMetersPerSec<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>var ySpeed <span class="op">=</span> leftJoystick<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> kMaxMetersPerSec<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>var rotSpeed <span class="op">=</span> rightJoystick<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> kMaxRadiansPerSec<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>var speeds <span class="op">=</span> <span class="kw">new</span> <span class="fu">ChassisSpeeds</span><span class="op">(</span>xSpeed<span class="op">,</span> ySpeed<span class="op">,</span> rotSpeed<span class="op">);</span></span></code></pre></div>
</section>
<section id="the-swervedrivekinematics-class" class="slide level2">
<h2>The <code>SwerveDriveKinematics</code> Class</h2>
</section>
<section id="the-swervemodulestate-class" class="slide level2">
<h2>The <code>SwerveModuleState</code> Class</h2>
</section>
<section id="swerve-kinematics-examples" class="slide level2">
<h2>Swerve Kinematics Examples</h2>
<p>We can use the Python version of WPILIB kinematics classes in a Jupyter notebook to easily convert desired robot speed and rotation into swerve wheel speeds and angles.</p>
<p>The classes and concepts are identical to the Java version we use on the robot.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define some useful constants</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>MAX_SPEED <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>MAX_ROTATION <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> math.pi</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the swerve drive kinematics class by specifying where the wheels are</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># relative to the center of the robot</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>fl_loc <span class="op">=</span> Translation2d(<span class="fl">0.3</span>, <span class="fl">0.3</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>fr_loc <span class="op">=</span> Translation2d(<span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.3</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>rl_loc <span class="op">=</span> Translation2d(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>rr_loc <span class="op">=</span> Translation2d(<span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.3</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>kinematics <span class="op">=</span> SwerveDrive4Kinematics(fl_loc, fr_loc, rl_loc, rr_loc)</span></code></pre></div>
</section>
<section class="slide level2">

<h3 id="drive-in-forward-direction">Drive in forward direction</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>speeds <span class="op">=</span> ChassisSpeeds(MAX_SPEED, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.toSwerveModuleStates(speeds)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.normalizeWheelSpeeds(module_states, MAX_SPEED)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plot_swerve(wheel_locs, module_states)</span></code></pre></div>
<p><img data-src="img/swerve-software/swerve-01.svg" style="width:60.0%" alt="swerve 01" /><br />
</p>
</section>
<section class="slide level2">

<h3 id="drive-in-forward-right-directions">Drive in forward, right directions</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>speeds <span class="op">=</span> ChassisSpeeds(MAX_SPEED, <span class="op">-</span>MAX_SPEED, <span class="dv">0</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.toSwerveModuleStates(speeds)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.normalizeWheelSpeeds(module_states, MAX_SPEED)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>plot_swerve(wheel_locs, module_states)</span></code></pre></div>
<p><img data-src="img/swerve-software/swerve-02.svg" style="width:60.0%" alt="swerve 02" /><br />
</p>
</section>
<section class="slide level2">

<h3 id="drive-in-forward-right-and-clockwise-directions">Drive in forward, right and clockwise directions</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>speeds <span class="op">=</span> ChassisSpeeds(MAX_SPEED, <span class="op">-</span>MAX_SPEED, <span class="op">-</span>MAX_ROTATION)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.toSwerveModuleStates(speeds)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>module_states <span class="op">=</span> kinematics.normalizeWheelSpeeds(module_states, MAX_SPEED)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plot_swerve(wheel_locs, module_states)</span></code></pre></div>
<p><img data-src="img/swerve-software/swerve-03.svg" style="width:60.0%" alt="swerve 03" /><br />
</p>
</section></section>
<section>
<section id="pathfinding-tools" class="title-slide slide level1">
<h1>Pathfinding Tools</h1>

</section>
<section id="pathweaver" class="slide level2">
<h2>Pathweaver</h2>
</section>
<section id="wpilib" class="slide level2">
<h2>WPILIB</h2>
</section></section>
    </div>
  </div>

  <script src="../static/reveal.js/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="../static/reveal.js/plugin/notes/notes.js"></script>
  <script src="../static/reveal.js/plugin/search/search.js"></script>
  <script src="../static/reveal.js/plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
      
        // Push each slide change to the browser history
        history: true,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1843.1999999999998,
        height: 1152,
        // Factor of the display size that should remain empty around the content
        margin: 0.08,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
